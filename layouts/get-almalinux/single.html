{{ define "main" }}
  <div class="al-body-container">
    <section class="al-page-index">
      <div class="al-index-faq">
        <div class="container al-py-lg">
          <h1 class="mb-3" style="text-align: center;">
            {{ i18n "Get AlmaLinux OS" }}
          </h1>
          <!-- AlmaLinux OS Version & Architecture Tabs -->
          <div class="al-tab-wrap">
            <!-- OS Version + Architecture Tabs Combined -->
            {{ partial "get-almalinux/tabs" . }}


            <!-- Tab Content from data -->
            {{ partial "get-almalinux/tab-content" . }}
          </div>
        </div>
      </div>

      <script>
        // Activate correct tab + section from hash
        (function () {
          const rawHash = window.location.hash;
          if (!rawHash) return;

          // Normalize hashes like #Cloud_Images-s390x-8 to #cloud_images-s390x-8
          let hash = rawHash;
          const m = rawHash.match(/^#([A-Za-z0-9]+)_([A-Za-z0-9]+)-(.+)$/);
          if (m) {
            const sectionId = m[1].toLowerCase();
            const arch = m[2];
            const version = m[3];
            hash = `#${sectionId}-${arch}-${version}`;
          }

          // sectionId-arch-version -> arch-version (tab id)
          const parts = hash.replace(/^#/, "").split("-");
          if (parts.length < 2) return;
          const archId = parts[parts.length - 2];
          const versionId = parts[parts.length - 1];
          const tabHash = `#${archId}-${versionId}`;

          const tabLink = document.querySelector(`a[href='${tabHash}']`);
          if (!tabLink) return;

          // Activate version/arch tab
          try {
            if (window.bootstrap && bootstrap.Tab) {
              const tabInstance = bootstrap.Tab.getOrCreateInstance(tabLink);
              tabInstance.show();
            } else {
              const allTabLinks = document.querySelectorAll(
                "[data-bs-toggle='tab']",
              );
              allTabLinks.forEach((el) => el.classList.remove("active"));
              tabLink.classList.add("active");

              const pane = document.querySelector(tabHash);
              if (pane) {
                document
                  .querySelectorAll(".tab-pane")
                  .forEach((p) => p.classList.remove("show", "active"));
                pane.classList.add("show", "active");
              }
            }
          } catch (e) {
            console.error("Error activating tab from hash", e);
          }

          // Scroll to specific section anchor if it exists; otherwise to the tab pane
          const sectionAnchor = document.querySelector(hash);
          if (sectionAnchor) {
            sectionAnchor.scrollIntoView({
              behavior: "smooth",
              block: "start",
            });
          } else {
            const pane = document.querySelector(tabHash);
            if (pane)
              pane.scrollIntoView({ behavior: "smooth", block: "start" });
          }
        })();
      </script>
    </section>
  </div>

  <script>
    // Ensure the first tab-button (if present) is marked active on load
    (function () {
      const btns = document.querySelectorAll(".tab-button");
      if (!btns.length) return;

      btns.forEach((item) =>
        item.addEventListener("click", () => {
          btns.forEach((element) => element.classList.remove("active"));
          item.classList.add("active");
        }),
      );

      btns[0].classList.add("active");
    })();
  </script>
{{ end }}
